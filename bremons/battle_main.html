<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BATTLE - BREMONS</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- ãƒãƒˆãƒ«ç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .battle-ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆç›¸æ‰‹æƒ…å ±ï¼‰ */
        .battle-header {
            background: rgba(20, 0, 0, 0.8);
            border-bottom: 2px solid #e74c3c;
            padding: 10px;
            color: #fff;
            display: flex; justify-content: space-between; align-items: center;
            pointer-events: auto;
        }
        .opponent-info { text-align: left; }
        .opponent-name { font-size: 18px; color: #e74c3c; font-weight: bold; }
        
        /* ãƒ©ã‚¤ãƒ•ã‚²ãƒ¼ã‚¸å…±é€š */
        .life-container { display: flex; gap: 5px; margin-top: 5px; }
        .life-heart { font-size: 20px; color: #555; transition: color 0.2s; }
        .life-heart.active { color: #e74c3c; text-shadow: 0 0 5px #e74c3c; } /* æ•µã¯èµ¤ */
        .my-life .life-heart.active { color: #2ecc71; text-shadow: 0 0 5px #2ecc71; } /* è‡ªåˆ†ã¯ç·‘ */

        /* ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆè‡ªåˆ†æƒ…å ±ãƒ»æ“ä½œãƒ‘ãƒãƒ«ï¼‰ */
        .battle-footer {
            background: rgba(0, 20, 0, 0.8);
            border-top: 2px solid #2ecc71;
            padding: 10px;
            color: #fff;
            pointer-events: auto;
        }
        .my-info { display: flex; justify-content: space-between; align-items: end; margin-bottom: 10px; }
        .my-name { font-size: 18px; color: #2ecc71; font-weight: bold; }

        /* ãƒãƒ£ãƒ¼ã‚¸ãƒ¡ãƒ¼ã‚¿ãƒ¼ */
        .charge-meter-box {
            width: 100%; height: 12px; background: #333; border: 1px solid #fff;
            margin-bottom: 10px; position: relative;
        }
        .charge-fill { height: 100%; width: 0%; background: #f1c40f; transition: width 0.1s linear; }
        .charge-label { 
            position: absolute; top: -18px; right: 0; font-size: 12px; color: #f1c40f; 
        }

        /* æŠ€ã‚¢ã‚¤ã‚³ãƒ³ãƒ»ã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º */
        .skill-panel { display: flex; justify-content: center; gap: 20px; }
        .skill-box {
            width: 60px; height: 60px; border: 2px solid #555; border-radius: 8px;
            background: rgba(0,0,0,0.5); display: flex; flex-direction: column;
            align-items: center; justify-content: center; position: relative;
        }
        .skill-icon { width: 32px; height: 32px; image-rendering: pixelated; }
        .skill-name { font-size: 10px; margin-top: 2px; }
        .skill-key { 
            position: absolute; top: -8px; left: -8px; background: #fff; color: #000;
            font-size: 10px; padding: 2px 4px; border-radius: 4px; font-weight: bold;
        }
        
        /* ã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .cooldown-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: #fff; font-weight: bold;
            opacity: 0; transition: opacity 0.1s;
        }
        .on-cooldown .cooldown-overlay { opacity: 1; }

        /* ãƒãƒˆãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå®‡å®™ç©ºé–“ï¼‰ */
        .battle-field {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5; overflow: hidden;
        }
        
        /* å®‡å®™èˆ¹ */
        .ship {
            position: absolute; width: 100px; height: 130px; 
            left: 50%; transform: translateX(-50%);
            transition: filter 0.1s;
        }
        .ship img { width: 100%; height: 100%; }
        
        .enemy-ship { top: 60px; transform: translateX(-50%) rotate(180deg); }
        .enemy-ship img { filter: hue-rotate(150deg) brightness(0.9); }
        .my-ship { bottom: 160px; } 

        /* è¢«å¼¾ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .shake { animation: shake 0.4s; }
        @keyframes shake {
            0% { transform: translateX(-50%) translate(0, 0); }
            25% { transform: translateX(-50%) translate(5px, 5px); }
            50% { transform: translateX(-50%) translate(-5px, -5px); }
            75% { transform: translateX(-50%) translate(5px, -5px); }
            100% { transform: translateX(-50%) translate(0, 0); }
        }

        /* å¼¾ */
        .bullet {
            position: absolute; width: 60px; height: 60px;
            image-rendering: pixelated; z-index: 6;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.8));
        }
        
        /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãƒ»å¾…æ©Ÿãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .countdown-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 50;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
        }
        #countdownText {
            font-size: 100px; color: #f1c40f; font-weight: bold;
            text-shadow: 4px 4px 0 #e74c3c;
            animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }
        .matching-msg {
            font-size: 20px; color: #fff; margin-top: 20px;
            animation: blink 1.5s infinite;
        }
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* çµæœç”»é¢ */
        .battle-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .result-title { font-size: 48px; margin-bottom: 20px; font-weight: bold; }
        .win { color: #f1c40f; text-shadow: 0 0 10px #f1c40f; }
        .lose { color: #34495e; text-shadow: 0 0 10px #fff; }
        
    </style>
</head>
<body>
    <audio id="bgm" src="./bgm/GuideToAdventure.mp3" loop></audio>

    <div class="game-container">
        <div class="scrolling-bg"></div>
        <div class="floating-layer"></div>

        <div class="battle-field" id="battleField">
            <div class="ship enemy-ship" id="enemyShip">
                <img src="./nightgame/rocket.png">
            </div>
            <div class="ship my-ship" id="myShip">
                <img src="./nightgame/rocket.png">
            </div>
        </div>

        <div class="battle-ui-layer">
            <div class="battle-header">
                <div class="opponent-info">
                    <div class="opponent-name" id="enemyName">WAITING...</div>
                    <div class="life-container enemy-life" id="enemyLifeBar">
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                    </div>
                </div>
                <button onclick="surrender()" class="pixel-btn" style="padding:5px 10px; font-size:12px;">é™å‚</button>
            </div>

            <div class="battle-footer">
                <div class="my-info">
                    <div class="my-name" id="myName">YOU</div>
                    <div class="life-container my-life" id="myLifeBar">
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                        <span class="life-heart active">â™¥</span>
                    </div>
                </div>

                <div class="charge-meter-box">
                    <div class="charge-fill" id="chargeBar"></div>
                    <span class="charge-label" id="chargeText">0.0s</span>
                </div>

                <div class="skill-panel">
                    <div class="skill-box" id="skillStar">
                        <span class="skill-key">ãµã€œ</span>
                        <img src="./nightgame/star.png" class="skill-icon">
                        <span class="skill-name">ã‚·ãƒ§ãƒƒãƒˆ</span>
                        <div class="cooldown-overlay"></div>
                    </div>
                    <div class="skill-box" id="skillBlue">
                        <span class="skill-key">2ç§’</span>
                        <img src="./nightgame/bluestar.png" class="skill-icon">
                        <span class="skill-name">ãƒ‘ãƒ¯ãƒ¼</span>
                        <div class="cooldown-overlay"></div>
                    </div>
                    <div class="skill-box" id="skillHa">
                        <span class="skill-key">ã¯ã£</span>
                        <span style="font-size:20px;">ğŸ›¡ï¸</span>
                        <span class="skill-name">ã‚¬ãƒ¼ãƒ‰</span>
                        <div class="cooldown-overlay"></div>
                    </div>
                    <div class="skill-box" id="skillPa">
                        <span class="skill-key">ã±ã£</span>
                        <span style="font-size:20px;">ğŸ›¡ï¸</span>
                        <span class="skill-name">ãƒãƒªã‚¢</span>
                        <div class="cooldown-overlay"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="countdownOverlay" class="countdown-layer hidden">
            <div id="countdownText">3</div>
            
            <div id="matchArea" class="hidden" style="text-align:center;">
                <div id="matchMsg" class="matching-msg">å¯¾æˆ¦ç›¸æ‰‹ã‚’æ¢ã—ã¦ã„ã¾ã™...</div>
                
                <div id="waitingCount" style="color:#2ecc71; margin:10px 0; font-size:14px;">å¾…æ©Ÿä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: ç¢ºèªä¸­...</div>
                <button onclick="cancelMatching()" class="pixel-btn" style="background:#e74c3c; margin-top:20px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>

        <div id="resultModal" class="battle-modal hidden">
            <div class="result-title" id="resultTitle">WIN!</div>
            <button onclick="location.href='battle_select.html'" class="pixel-btn start-btn">æˆ»ã‚‹</button>
        </div>
    </div>

    <script type="module" src="battle_script.js"></script>
    <script>
        document.body.addEventListener('click', function() {
            var bgm = document.getElementById('bgm');
            if(bgm.paused) bgm.play();
        }, { once: true });

        window.surrender = function() {
            if(confirm("é™å‚ã—ã¾ã™ã‹ï¼Ÿï¼ˆè² ã‘ã«ãªã‚Šã¾ã™ï¼‰")) {
                location.href = 'battle_select.html';
            }
        };
        document.addEventListener('DOMContentLoaded', () => {
            const bgm = document.getElementById('bgm');
            bgm.volume = 0.3;
            bgm.play().catch(() => {});
            document.body.addEventListener('click', () => { if (bgm.paused) bgm.play(); }, { once: true });
        });
    </script>
</body>
</html>